<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel – Portfolio</title>

<style>
body {
    font-family: Poppins, sans-serif;
    background: #111;
    color: white;
    padding: 20px;
}

h1 {
    text-align: center;
}

.gallery {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.photo-box {
    position: relative;
}

.photo-box img {
    width: 100%;
    aspect-ratio: 1/1;
    object-fit: cover;
    border-radius: 12px;
}

.delete-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: red;
    border: none;
    color: white;
    padding: 6px 10px;
    border-radius: 6px;
    cursor: pointer;
}
</style>
</head>

<body>

<h1>Admin Panel – Kelola Foto</h1>

<!-- Upload foto -->
<input type="file" id="uploadInput" accept="image/*">
<button onclick="uploadPhoto()">Upload Foto</button>

<div class="gallery" id="gallery"></div>

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
/* CONFIG FIREBASE (PUNYA KAMU) */
const firebaseConfig = {
  apiKey: "AIzaSyBeCvaqOiqVJsTW3EH2iUGYvAwub_VtI9M",
  authDomain: "portfolio-nabil.firebaseapp.com",
  databaseURL: "https://portfolio-nabil-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "portfolio-nabil",
  storageBucket: "portfolio-nabil.firebasestorage.app",
  messagingSenderId: "541632788938",
  appId: "1:541632788938:web:5fab9f0f28043b4296f733",
  measurementId: "G-YKQZCD5J3S"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* CONFIG CLOUDINARY */
const cloudName = "dvgfdtbyf";
const uploadPreset = "portofolio_nabil";

/* UPLOAD FOTO */
function uploadPhoto() {
    let file = document.getElementById("uploadInput").files[0];
    if (!file) return alert("Pilih foto dulu!");

    let formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", uploadPreset);

    // Upload ke Cloudinary
    fetch(`https://api.cloudinary.com/v1_1/${cloudName}/image/upload`, {
        method: "POST",
        body: formData
    })
    .then(res => res.json())
    .then(result => {
        let url = result.secure_url;
        saveToFirebase(url);
    });
}

/* SIMPAN FOTO KE FIREBASE */
function saveToFirebase(url) {
    db.ref("project_gallery").push({
        image: url,
        time: Date.now()
    });
}

/* HAPUS FOTO */
function deletePhoto(id) {
    if (!confirm("Yakin hapus foto ini?")) return;
    db.ref("project_gallery/" + id).remove();
}

/* LOAD FOTO */
function loadGallery() {
    const gallery = document.getElementById("gallery");

    db.ref("project_gallery").on("value", snapshot => {
        gallery.innerHTML = "";

        snapshot.forEach(child => {
            const data = child.val();
            const id = child.key;

            let box = document.createElement("div");
            box.className = "photo-box";

            box.innerHTML = `
                <img src="${data.image}">
                <button class="delete-btn" onclick="deletePhoto('${id}')">❌</button>
            `;

            gallery.appendChild(box);
        });
    });
}

loadGallery();
</script>

</body>
</html>
